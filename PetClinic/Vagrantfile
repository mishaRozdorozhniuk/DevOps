Vagrant.configure("2") do |config|
  config.vm.define "APP_VM" do |app_vm|
    app_vm.vm.box = "ubuntu/bionic64"  # Ubuntu 18.04 official box
    app_vm.vm.hostname = "app-vm"

    # Optional: Port forwarding
    app_vm.vm.network "forwarded_port", guest: 8080, host: 8080

    app_vm.vm.provision "shell", path: "connect-db.sh"
  end

  config.vm.define "DB_VM" do |db_vm|
    db_vm.vm.box = "ubuntu/bionic64"
    db_vm.vm.hostname = "db-vm"

    # Set environment variables (not persistent across reboots unless exported properly)
    db_vm.vm.provision "shell", inline: <<-SHELL
      echo "export DB_USER='#{ENV['DB_USER']}'" >> /etc/profile.d/db_env.sh
      echo "export DB_PASS='#{ENV['DB_PASS']}'" >> /etc/profile.d/db_env.sh
      echo "export DB_NAME='#{ENV['DB_NAME']}'" >> /etc/profile.d/db_env.sh
      chmod +x /etc/profile.d/db_env.sh
    SHELL

    db_vm.vm.provision "shell", path: "start.sh"

    db_vm.vm.network "private_network", ip: "192.168.56.10"
  end
end
